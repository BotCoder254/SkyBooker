<!-- Booking Details Page -->
<div class="flex h-screen bg-gray-100">
    <!-- Sidebar (Same as dashboard) -->
    <div class="hidden md:flex md:flex-shrink-0">
        <div class="flex flex-col w-64 bg-gray-800">
            <!-- Sidebar Header -->
            <div class="flex items-center justify-center h-16 px-4 bg-gray-900">
                <h2 class="text-lg font-bold text-white">Flight Dashboard</h2>
            </div>
            
            <!-- Sidebar Navigation -->
            <div class="flex flex-col flex-1 overflow-y-auto">
                <nav class="flex-1 px-2 py-4 space-y-1">
                    <a href="/dashboard" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-md">
                        <i class="fas fa-home mr-3"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="/flights" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-md">
                        <i class="fas fa-plane mr-3"></i>
                        <span>Flights</span>
                    </a>
                    <a href="/bookings" class="flex items-center px-4 py-3 text-white bg-gray-700 rounded-md">
                        <i class="fas fa-ticket-alt mr-3"></i>
                        <span>My Bookings</span>
                    </a>
                    <a href="/profile" class="flex items-center px-4 py-3 text-gray-300 hover:bg-gray-700 rounded-md">
                        <i class="fas fa-user mr-3"></i>
                        <span>Profile</span>
                    </a>
                </nav>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex flex-col flex-1 overflow-hidden">
        <!-- Top Navigation -->
        <header class="flex items-center justify-between px-6 py-4 bg-white border-b">
            <div class="flex items-center">
                <button class="text-gray-500 focus:outline-none md:hidden">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 class="text-xl font-semibold text-gray-800 ml-4">Booking Details</h2>
            </div>
            <div>
                <button onclick="printTicket()" class="flex items-center px-4 py-2 text-sm text-white bg-red-500 rounded-md hover:bg-red-600">
                    <i class="fas fa-print mr-2"></i>
                    Print Ticket
                </button>
            </div>
        </header>

        <!-- Booking Content -->
        <main class="flex-1 overflow-y-auto bg-gray-100">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <!-- Booking Status -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Booking Status</h3>
                            <p class="text-sm text-gray-500" id="bookingReference"></p>
                        </div>
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full mr-2" id="statusDot"></div>
                            <span class="text-sm font-medium" id="bookingStatus"></span>
                        </div>
                    </div>
                </div>

                <!-- Flight Details -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Flight Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div>
                            <span class="text-sm text-gray-500">Flight Number</span>
                            <p class="text-lg font-semibold" id="flightNumber"></p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">From - To</span>
                            <p class="text-lg font-semibold" id="route"></p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">Date & Time</span>
                            <p class="text-lg font-semibold" id="datetime"></p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">Duration</span>
                            <p class="text-lg font-semibold" id="duration"></p>
                        </div>
                    </div>
                </div>

                <!-- Passenger Details -->
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Passenger Details</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Passport</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Seat</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="passengerList">
                                <!-- Passenger rows will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Payment Details -->
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Payment Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div>
                            <span class="text-sm text-gray-500">Payment Method</span>
                            <p class="text-lg font-semibold">M-Pesa</p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">Transaction ID</span>
                            <p class="text-lg font-semibold" id="transactionId"></p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">Payment Status</span>
                            <p class="text-lg font-semibold" id="paymentStatus"></p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-500">Total Amount</span>
                            <p class="text-lg font-semibold text-red-500" id="totalAmount"></p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
let bookingData = null;

// Initialize booking details page
async function initBookingDetails() {
    const bookingId = window.location.pathname.split('/').pop();
    
    try {
        const response = await fetch(`/api/bookings/${bookingId}`);
        const data = await response.json();
        
        if (data.status === 'success') {
            bookingData = data.data.booking;
            displayBookingDetails();
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error loading booking details');
    }
}

// Display booking details
function displayBookingDetails() {
    // Booking Status
    document.getElementById('bookingReference').textContent = `Booking Reference: ${bookingData._id}`;
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('bookingStatus');
    
    switch(bookingData.status) {
        case 'confirmed':
            statusDot.classList.add('bg-green-500');
            statusText.textContent = 'Confirmed';
            statusText.classList.add('text-green-500');
            break;
        case 'pending':
            statusDot.classList.add('bg-yellow-500');
            statusText.textContent = 'Pending';
            statusText.classList.add('text-yellow-500');
            break;
        case 'cancelled':
            statusDot.classList.add('bg-red-500');
            statusText.textContent = 'Cancelled';
            statusText.classList.add('text-red-500');
            break;
    }
    
    // Flight Details
    document.getElementById('flightNumber').textContent = bookingData.flight.flightNumber;
    document.getElementById('route').textContent = `${bookingData.flight.departureCity} - ${bookingData.flight.arrivalCity}`;
    document.getElementById('datetime').textContent = new Date(bookingData.flight.departureTime).toLocaleString();
    document.getElementById('duration').textContent = bookingData.flight.duration;
    
    // Passenger Details
    const passengerList = document.getElementById('passengerList');
    bookingData.passengers.forEach((passenger, index) => {
        const row = `
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">${passenger.firstName} ${passenger.lastName}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">${passenger.email}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">${passenger.phone}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">${passenger.passportNumber}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">${bookingData.seatNumbers[index]}</div>
                </td>
            </tr>
        `;
        passengerList.insertAdjacentHTML('beforeend', row);
    });
    
    // Payment Details
    document.getElementById('transactionId').textContent = bookingData.payment.mpesaReceiptNumber || 'N/A';
    document.getElementById('paymentStatus').textContent = bookingData.payment.status;
    document.getElementById('totalAmount').textContent = `KES ${bookingData.totalAmount.toLocaleString()}`;
}

// Print ticket
function printTicket() {
    window.print();
}

// Initialize page
initBookingDetails();
</script>

<style>
@media print {
    .hidden {
        display: none !important;
    }
    
    .shadow-lg {
        box-shadow: none !important;
    }
    
    .bg-gray-100 {
        background-color: white !important;
    }
    
    .text-red-500 {
        color: black !important;
    }
}
</style> 