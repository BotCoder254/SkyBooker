<!-- Profile Page -->
<div class="flex h-screen bg-gray-100">
    

    <!-- Main Content -->
    <div class="flex flex-col flex-1 overflow-hidden">
        <!-- Top Navigation -->
        <header class="flex items-center justify-between px-6 py-4 bg-white border-b">
            <div class="flex items-center">
                <button class="text-gray-500 focus:outline-none md:hidden">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 class="text-xl font-semibold text-gray-800 ml-4">Profile Settings</h2>
            </div>
        </header>

        <!-- Profile Content -->
        <main class="flex-1 overflow-y-auto bg-gray-100">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <div class="md:grid md:grid-cols-3 md:gap-6">
                    <!-- Profile Information -->
                    <div class="md:col-span-1">
                        <div class="px-4 sm:px-0">
                            <h3 class="text-lg font-medium leading-6 text-gray-900">Profile Information</h3>
                            <p class="mt-1 text-sm text-gray-600">
                                Update your personal information and contact details.
                            </p>
                        </div>
                    </div>
                    
                    <div class="mt-5 md:mt-0 md:col-span-2">
                        <form id="profileForm" class="space-y-6">
                            <div class="shadow rounded-md overflow-hidden">
                                <div class="px-4 py-5 bg-white space-y-6 sm:p-6">
                                    <div class="grid grid-cols-6 gap-6">
                                        <div class="col-span-6 sm:col-span-3">
                                            <label class="block text-sm font-medium text-gray-700">First Name</label>
                                            <input type="text" 
                                                   id="firstName"
                                                   name="firstName"
                                                   class="mt-1 block w-full h-12 rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring focus:ring-red-200">
                                        </div>
                                        
                                        <div class="col-span-6 sm:col-span-3">
                                            <label class="block text-sm font-medium text-gray-700">Last Name</label>
                                            <input type="text" 
                                                   id="lastName"
                                                   name="lastName"
                                                   class="mt-1 block w-full h-12 rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring focus:ring-red-200">
                                        </div>
                                        
                                        <div class="col-span-6 sm:col-span-4">
                                            <label class="block text-sm font-medium text-gray-700">Email Address</label>
                                            <input type="email" 
                                                   id="email"
                                                   name="email"
                                                   class="mt-1 block w-full h-12 rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring focus:ring-red-200">
                                        </div>
                                        
                                        <div class="col-span-6 sm:col-span-3">
                                            <label class="block text-sm font-medium text-gray-700">Phone Number</label>
                                            <input type="tel" 
                                                   id="phone"
                                                   name="phone"
                                                   class="mt-1 block w-full h-12 rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring focus:ring-red-200">
                                        </div>
                                    </div>
                                </div>
                                <div class="px-4 py-3 bg-gray-50 text-right sm:px-6">
                                    <button type="submit" 
                                            class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-500 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                        Save Changes
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="hidden sm:block" aria-hidden="true">
                    <div class="py-5">
                        <div class="border-t border-gray-200"></div>
                    </div>
                </div>

                <!-- Change Password -->
                <div class="mt-10 sm:mt-0">
                    <div class="md:grid md:grid-cols-3 md:gap-6">
                        <div class="md:col-span-1">
                            <div class="px-4 sm:px-0">
                                <h3 class="text-lg font-medium leading-6 text-gray-900">Change Password</h3>
                                <p class="mt-1 text-sm text-gray-600">
                                    Update your password to keep your account secure.
                                </p>
                            </div>
                        </div>
                        
                        <div class="mt-5 md:mt-0 md:col-span-2">
                            <form id="passwordForm" class="space-y-6">
                                <div class="shadow rounded-md overflow-hidden">
                                    <div class="px-4 py-5 bg-white space-y-6 sm:p-6">
                                        <div class="grid grid-cols-6 gap-6">
                                            <div class="col-span-6 sm:col-span-4">
                                                <label class="block text-sm font-medium text-gray-700">Current Password</label>
                                                <input type="password" 
                                                       id="currentPassword"
                                                       name="currentPassword"
                                                       class="mt-1 block w-full h-12 rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring focus:ring-red-200">
                                            </div>
                                            
                                            <div class="col-span-6 sm:col-span-4">
                                                <label class="block text-sm font-medium text-gray-700">New Password</label>
                                                <input type="password" 
                                                       id="newPassword"
                                                       name="newPassword"
                                                       class="mt-1 block w-full h-12 rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring focus:ring-red-200">
                                            </div>
                                            
                                            <div class="col-span-6 sm:col-span-4">
                                                <label class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                                                <input type="password" 
                                                       id="confirmPassword"
                                                       name="confirmPassword"
                                                       class="mt-1 block w-full h-12 rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring focus:ring-red-200">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="px-4 py-3 bg-gray-50 text-right sm:px-6">
                                        <button type="submit" 
                                                class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-500 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                                            Update Password
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
// Initialize profile page
async function initProfile() {
    try {
        const response = await fetch('/api/auth/me');
        const data = await response.json();
        
        if (data.status === 'success') {
            const user = data.data.user;
            document.getElementById('firstName').value = user.name.split(' ')[0] || '';
            document.getElementById('lastName').value = user.name.split(' ')[1] || '';
            document.getElementById('email').value = user.email;
            document.getElementById('phone').value = user.phone;
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error loading profile');
    }
}

// Update profile
async function updateProfile(event) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    const firstName = formData.get('firstName');
    const lastName = formData.get('lastName');
    
    try {
        const response = await fetch('/api/auth/update-profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: `${firstName} ${lastName}`,
                email: formData.get('email'),
                phone: formData.get('phone')
            })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
            alert('Profile updated successfully');
        } else {
            alert(data.message || 'Error updating profile');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error updating profile');
    }
}

// Update password
async function updatePassword(event) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    const newPassword = formData.get('newPassword');
    const confirmPassword = formData.get('confirmPassword');
    
    if (newPassword !== confirmPassword) {
        alert('New passwords do not match');
        return;
    }
    
    try {
        const response = await fetch('/api/auth/update-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                currentPassword: formData.get('currentPassword'),
                newPassword
            })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
            alert('Password updated successfully');
            event.target.reset();
        } else {
            alert(data.message || 'Error updating password');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error updating password');
    }
}

// Add event listeners
document.getElementById('profileForm').addEventListener('submit', updateProfile);
document.getElementById('passwordForm').addEventListener('submit', updatePassword);

// Initialize page
initProfile();
</script> 